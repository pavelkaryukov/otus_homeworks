#pragma once
#include <tuple>
///Стянуто https://blog.tartanllama.xyz/exploding-tuples-fold-expressions/
namespace tuple_utils
{
    //-----------------------------------------------------------------------------
    template <std::size_t... Idx>
    auto make_index_dispatcher(std::index_sequence<Idx...>)
    {
        return [](auto&& f) { (f(std::integral_constant<std::size_t, Idx>{}), ...); };
    }
    //-----------------------------------------------------------------------------
    template <std::size_t N>
    auto make_index_dispatcher()
    {
        return make_index_dispatcher(std::make_index_sequence<N>{});
    }
    //-----------------------------------------------------------------------------
    template <typename Tuple, typename Func>
    void for_each(const Tuple& t, const Func& f)
    {
        constexpr auto n = std::tuple_size<std::decay_t<Tuple>>::value;
        auto dispatcher = make_index_dispatcher<n>();
        dispatcher([&f, &t](auto idx) { f(std::get<idx>(t)); });
    }

    /*template <typename Tuple, typename Func>
    void for_each(Tuple&& t, Func&& f) {
        constexpr auto n = std::tuple_size<std::decay_t<Tuple>>::value;
        auto dispatcher = make_index_dispatcher<n>();
        dispatcher([&f, &t](auto idx) { f(std::get<idx>(std::forward<Tuple>(t))); });
    }*/
} // tuple_utils
